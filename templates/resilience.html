<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›å¾©ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å±¥æ­´</title>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='CSS/style.css') }}">
  <script>
    function likeRecovery(recordId) {
      fetch('/like_recovery/' + recordId, {
        method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          document.getElementById("likes-" + recordId).innerText = data.likes;
          location.reload(); // å†èª­ã¿è¾¼ã¿ã—ã¦ã€Œã„ã„ã­æ¸ˆã€åæ˜ 
        }
      });
    }

    function changeOrder() {
      let order = document.getElementById("orderSelect").value;
      window.location.href = "/resilience?order=" + order;
    }

    function toggleHistory() {
      const historyDiv = document.getElementById("history");
      historyDiv.style.display = historyDiv.style.display === "none" ? "block" : "none";
    }
  </script>
</head>
<body>
  <div class="container">
    <h1>å›å¾©ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å±¥æ­´</h1>

      <!-- è‡ªåˆ†ã®è¨˜éŒ²ï¼ˆæœ€æ–°1ä»¶ã ã‘è¡¨ç¤ºï¼‰ -->
      <h2>è‡ªåˆ†ã®è¨˜éŒ²</h2>
      {% if my_recovery_data %}
        <ul>
          <div class="setting-box">
            <strong>è¨˜éŒ²æ—¥</strong> {{ my_recovery_data[0].created_at.strftime('%Yå¹´%mæœˆ%dæ—¥') }}<br>
            <div class="setting-row">
              <div class="setting-item"><strong>å¤±æ•—ã®åŸå› </strong><br> {{ my_recovery_data[0].reason }}<br></div>
              <div class="setting-item"><strong>æ”¹å–„æ–¹æ³•</strong><br> {{ my_recovery_data[0].improvement }}<br></div>
            </div>
            <strong>ç¶™ç¶šæ—¥æ•°:</strong> {{ my_streak }} æ—¥
          </div>
        </ul>
        {% if my_recovery_data|length > 1 %}
          <details>
            <summary>éå»ã®å±¥æ­´ã‚’è¡¨ç¤º</summary>
            <ul>
              {% for record in my_recovery_data[1:] %}
                <li>
                  <strong>è¨˜éŒ²æ—¥</strong> {{ record.created_at.strftime('%Yå¹´%mæœˆ%dæ—¥') }}<br>
                  <strong>å¤±æ•—ã®åŸå› :</strong> {{ record.reason }}<br>
                  <strong>æ”¹å–„æ–¹æ³•:</strong> {{ record.improvement }}<br>
                </li>
              {% endfor %}
            </ul>
          </details>
        {% endif %}
      {% else %}
        <p>è‡ªåˆ†ã®è¨˜éŒ²ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      {% endif %}
      
      <h2>ã¿ã‚“ãªã®è¨˜éŒ²</h2>
      <label for="orderSelect">ä¸¦ã³é †:</label>
      <select id="orderSelect" onchange="changeOrder()">
        <option value="popular" {% if order_by == 'popular' %}selected{% endif %}>äººæ°—é †</option>
        <option value="new" {% if order_by == 'new' %}selected{% endif %}>æ–°ã—ã„é †</option>
        <option value="streak" {% if order_by == 'streak' %}selected{% endif %}>ç¶™ç¶šæ—¥æ•°é †</option>
      </select>
      
      <ul>
        {% for record in recovery_data %}
          <div class="setting-box">
              <strong>è¨˜éŒ²æ—¥</strong> {{ record.created_at.strftime('%Yå¹´%mæœˆ%dæ—¥') }}<br>
              <div class="setting-row">
                <div class="setting-item"><strong>å¤±æ•—ã®åŸå› </strong> <br>{{ record.reason }}</div>
                <div class="setting-item"><strong>æ”¹å–„æ–¹æ³•</strong><br> {{ record.improvement }}<br></div>
              </div>
              <strong>ç¶™ç¶šæ—¥æ•°:</strong> {{ record.streak }} æ—¥<br>
              {% if record.id in liked_ids %}
                <button disabled>ğŸ‘ ã„ã„ã­æ¸ˆ</button>
              {% else %}
                <button onclick="likeRecovery({{ record.id }})">ğŸ‘ ã„ã„ã­</button>
              {% endif %}
              <span id="likes-{{ record.id }}">{{ record.likes }}</span>
          </div>
        {% endfor %}
      </ul>      
  

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="pagination">
      {% if page > 1 %}
        <a href="{{ url_for('resilience', order=order_by, page=page-1) }}">Â« å‰ã¸</a>
      {% endif %}
      <span>ãƒšãƒ¼ã‚¸ {{ page }} / {{ total_pages }}</span>
      {% if page < total_pages %}
        <a href="{{ url_for('resilience', order=order_by, page=page+1) }}">æ¬¡ã¸ Â»</a>
      {% endif %}
    </div>

  </div>

  <footer>
    <ul>
      <li><a href="/mypage">ãƒã‚¤ãƒšãƒ¼ã‚¸</a></li>
      <li><a href="/record">è¨˜éŒ²</a></li>
      <li><a href="/resilience">å›å¾©</a></li>
      <li><a href="/analysis">åˆ†æ</a></li>
      <li><a href="/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
    </ul>
  </footer>
</body>
</html>


