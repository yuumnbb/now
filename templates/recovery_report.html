<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›å¾©ãƒ—ãƒ­ã‚°ãƒ©ãƒ  - è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='CSS/style.css') }}">
  <style>
    :root {
      --primary-color: #4a90e2;
      --bg-color: #f4f7f6;
      --card-bg: #ffffff;
      --text-main: #333;
      --text-muted: #666;
      --accent-color: #2ecc71;
    }

    body {
      background-color: var(--bg-color);
      font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
      color: var(--text-main);
      line-height: 1.6;
      margin: 0;
      padding: 0;
    }

    .report-layout {
      display: flex;
      max-width: 1200px;
      margin: 40px auto;
      gap: 30px;
      padding: 0 20px;
    }

    /* å±¥æ­´ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
    .history-sidebar {
      width: 250px;
      flex-shrink: 0;
    }

    .history-card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      padding: 20px;
      position: sticky;
      top: 20px;
    }

    .history-title {
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 15px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 70vh;
      overflow-y: auto;
    }

    .history-item {
      margin-bottom: 8px;
    }

    .history-link {
      display: block;
      padding: 10px 12px;
      text-decoration: none;
      color: var(--text-main);
      border-radius: 8px;
      font-size: 0.9rem;
      transition: background 0.2s;
      border: 1px solid transparent;
    }

    .history-link:hover {
      background-color: #f0f7ff;
      color: var(--primary-color);
    }

    .history-link.active {
      background-color: var(--primary-color);
      color: white;
      font-weight: bold;
    }

    /* ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒãƒ¼ãƒˆã‚¨ãƒªã‚¢ */
    .main-report {
      flex-grow: 1;
    }

    .report-card {
      background: var(--card-bg);
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .report-header {
      background: linear-gradient(135deg, var(--primary-color), #357abd);
      color: white;
      padding: 30px;
    }

    .report-header h2 { margin: 0; font-size: 1.5rem; }
    .report-header p { margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9rem; }

    .content-section { padding: 30px; }

    .section-title {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--primary-color);
      border-left: 4px solid var(--primary-color);
      padding-left: 12px;
      margin-bottom: 15px;
      margin-top: 30px;
    }
    .section-title:first-child { margin-top: 0; }

    .ai-box {
      background-color: #f0f7ff;
      border: 1px solid #d0e3ff;
      padding: 20px;
      border-radius: 10px;
      white-space: pre-wrap;
      font-size: 0.95rem;
      line-height: 1.7;
    }

    .user-content-box {
      background-color: #fafafa;
      padding: 15px;
      border-radius: 8px;
      border: 1px inset #eee;
      margin-bottom: 20px;
    }

    .meta-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 25px;
    }

    .meta-item label {
      display: block;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .meta-item span { font-weight: bold; font-size: 1rem; }

    .search-form {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
    }

    .search-form input {
      flex-grow: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    .search-form button {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 0 15px;
      border-radius: 8px;
      cursor: pointer;
    }

    @media (max-width: 850px) {
      .report-layout { flex-direction: column; }
      .history-sidebar { width: 100%; }
      .history-card { position: static; }
      .meta-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div style="max-width: 1200px; margin: 20px auto; padding: 0 20px;">
    <h1>å›å¾©ãƒ—ãƒ­ã‚°ãƒ©ãƒ  è¨ºæ–­ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h1>
    
    <form action="{{ url_for('view_recovery_report') }}" method="get" class="search-form">
      <input type="text" name="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã§æ¤œç´¢..." value="{{ search_username }}">
      <button type="submit">è¡¨ç¤º</button>
    </form>
  </div>

  <div class="report-layout">
    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼: å±¥æ­´ä¸€è¦§ -->
    <aside class="history-sidebar">
      <div class="history-card">
        <div class="history-title">ğŸ“… éå»ã®è¨ºæ–­å±¥æ­´</div>
        <ul class="history-list">
          {% for h in history %}
          <li class="history-item">
            <a href="{{ url_for('view_recovery_report', username=search_username, re_id=h.id) }}" 
               class="history-link {% if report and report.id == h.id %}active{% endif %}">
              {{ h.created_at.strftime('%Y/%m/%d %H:%M') }}
            </a>
          </li>
          {% else %}
          <li style="font-size: 0.8rem; color: #999; text-align: center; padding: 20px;">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</li>
          {% endfor %}
        </ul>
      </div>
    </aside>

    <!-- ãƒ¡ã‚¤ãƒ³: ãƒ¬ãƒãƒ¼ãƒˆè©³ç´° -->
    <main class="main-report">
      {% if report %}
      <div class="report-card">
        <div class="report-header">
          <h2>{{ report.username }} ã•ã‚“ã®ãƒ¬ãƒãƒ¼ãƒˆ</h2>
          <p>è¨ºæ–­æ—¥æ™‚: {{ report.created_at.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}</p>
        </div>

        <div class="content-section">
          <div class="meta-grid">
            <div class="meta-item">
              <label>å­¦ç¿’ç›®æ¨™</label>
              <span>{{ report.goal or 'æœªè¨­å®š' }}</span>
            </div>
            <div class="meta-item">
              <label>å°ã•ãªè¡Œå‹•</label>
              <span>{{ report.small_action or 'æœªè¨­å®š' }}</span>
            </div>
          </div>

          <div class="section-title">ã‚ãªãŸã®æŒ¯ã‚Šè¿”ã‚Š</div>
          <div class="user-content-box">
            <div style="margin-bottom: 10px;">
              <strong>ğŸ’­ åŸå› ã®è‡ªå·±åˆ†æ:</strong><br>
              {{ report.reason }}
            </div>
            <div>
              <strong>ğŸš€ æ±ºã‚ãŸå¯¾ç­–:</strong><br>
              {{ report.improvement }}
            </div>
          </div>

          <div class="section-title">âœ¨ AIã«ã‚ˆã‚‹åˆ†æ (Analysis)</div>
          <div class="ai-box">{{ report.re_analysis or 'åˆ†æãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚' }}</div>

          <div class="section-title">ğŸ’¡ AIã‹ã‚‰ã®æœ€çµ‚ã‚¢ãƒ‰ãƒã‚¤ã‚¹ (Feedback)</div>
          <div class="ai-box">{{ report.ai_feedback or 'ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚' }}</div>
          
          <div style="margin-top: 30px; text-align: center;">
            <a href="{{ url_for('mypage') }}" style="color: var(--primary-color); text-decoration: none; font-weight: bold;">â† ãƒã‚¤ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</a>
          </div>
        </div>
      </div>
      {% else %}
      <div class="report-card" style="padding: 50px; text-align: center;">
        <p style="color: #999;">è¡¨ç¤ºã™ã‚‹ãƒ¬ãƒãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
      </div>
      {% endif %}
    </main>
  </div>
</body>
</html>